apply plugin: 'com.android.application'
apply from: '../compat/preprocess.gradle'
apply from: '../gradle/constants.gradle'

/*
 *  Iadt PLUGIN: import directly from modules. For development.
 */
//apply from: '../plugin/build.gradle'

/*
 *  Iadt PLUGIN: import from repository (jCenter or localMaven). Standard usage
 */
apply plugin: 'es.rafaco.inappdevtools'


android {
    compileSdkVersion PROJECT_COMPILE_SDK
    buildToolsVersion PROJECT_BUILD_TOOLS
    defaultConfig {
        applicationId "es.rafaco.inappdevtools.demo"
        minSdkVersion PROJECT_MIN_SDK
        targetSdkVersion PROJECT_TARGET_SDK
        versionCode DEMO_VERSION_CODE
        versionName DEMO_VERSION

        //TODO: remove
        multiDexEnabled false
    }

    flavorDimensions "compatibility"
    productFlavors {
        support {
            dimension "compatibility"
            processor.symbols "SUPPORT"
            matchingFallbacks = ['debug', 'release']
            testInstrumentationRunner "android.support.test.runner.AndroidJUnitRunner"
        }
        androidx {
            dimension "compatibility"
            processor.symbols "ANDROIDX"
            matchingFallbacks = ['debug', 'release']
            testInstrumentationRunner "androidx.test.runner.AndroidJUnitRunner"
        }
    }

    buildTypes {
        release {
            minifyEnabled false
            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'
        }
    }

    compileOptions {
        sourceCompatibility JavaVersion.VERSION_1_7
        targetCompatibility JavaVersion.VERSION_1_8
    }
}

dependencies {
    implementation fileTree(include: ['*.jar'], dir: 'libs')

    /*
     *  Iadt COMPAT: import directly from modules. For release, debug have it from library
     */
    releaseApi project(path: ':compat')

    /*
     *  Iadt COMPAT: import from repository (jCenter or localMaven). Standard usage
     */
    //androidxImplementation "es.rafaco.compat:androidx:$LIBRARY_VERSION"
    //supportImplementation "es.rafaco.compat:support:$LIBRARY_VERSION"

    // AndroidX/Support view components added by compat module:
    //    androidxApi "androidx.appcompat:appcompat:$rootProject.ext.libraryAndroidxVersion"
    //    supportApi "com.android.support:appcompat-v7:$rootProject.ext.appSupportVersion"
    //    androidxApi "com.google.android.material:material:$rootProject.ext.libraryAndroidxMaterialVersion"
    //    supportApi "com.android.support:design:$rootProject.ext.appSupportVersion"
    //    supportApi "com.android.support:support-v4:$rootProject.ext.appSupportVersion"
    //    androidxApi "androidx.recyclerview:recyclerview:$rootProject.ext.libraryAndroidxVersion"
    //    supportApi "com.android.support:recyclerview-v7:$rootProject.ext.appSupportVersion"


    /*
     *  Iadt LIBRARY: import directly from modules. For development.
     */
    debugApi project(path: ':library')
    releaseApi project(path: ':noop')

    /*
     *  Iadt LIBRARY: import from repository (jCenter or localMaven). Standard usage
     */
    //supportImplementation "es.rafaco.inappdevtools:support:$libraryPublishedVersion"
    //androidxImplementation "es.rafaco.inappdevtools:androidx:$libraryPublishedVersion"
    //releaseImplementation "es.rafaco.inappdevtools:noop:$libraryPublishedVersion"


    //Retrofit
    api "com.squareup.retrofit2:retrofit:$RETROFIT_VERSION"
    api "com.squareup.retrofit2:converter-gson:$RETROFIT_VERSION"

    //Test
    testImplementation 'junit:junit:4.12'

    // AndroidX/Support test components (TODO)
    androidTestAndroidxImplementation 'androidx.test:runner:1.1.0'
    androidTestAndroidxImplementation 'androidx.test.espresso:espresso-core:3.1.0'
    androidTestSupportImplementation 'com.android.support.test:runner:1.0.2'
    androidTestSupportImplementation 'com.android.support.test.espresso:espresso-core:3.0.2'
}

/*
 *  Iadt CONFIGURATION
 */
inappdevtools {
    //// User features fags
    email = 'inappdevtools@gmail.com'
    notes = "This is a SAMPLE NOTE about this compilation:\n" +
            " - Developers can add any text here using Gradle configuration\n" +
            " - Useful to describe changes or to provide instructions"

    //// Build flags (affect plugin)
    //enabled = true
    //enabledOnRelease = true
    debug = false
    //sourceInclusion = false
    //sourceInspection = false

    //// Runtime flags (used later on)
    //overlayEnabled = false
    //invocationByShake = false
    //invocationByIcon = true
    //callDefaultCrashHandler = true
}



sonarqube {
    androidVariant 'supportDebug'
}

task startApp(type: Exec) {
    def NAMESPACE_AND_ACTIVITY = 'es.rafaco.inappdevtools.demo/.view.MainActivity'

    if (System.properties['os.name'].toLowerCase().contains('windows')) {
        commandLine 'cmd', '/c', 'adb', 'shell', 'am', 'start', '-n', NAMESPACE_AND_ACTIVITY
    } else {
        commandLine 'adb', 'shell', 'am', 'start', '-n', NAMESPACE_AND_ACTIVITY
    }
}