apply plugin: 'com.android.library'
apply from: '../gradle/constants.gradle'
apply from: 'publish.gradle'
//apply plugin: 'es.rafaco.inappdevtools'
apply from: '../compat/preprocess.gradle'

android {
    compileSdkVersion PROJECT_COMPILE_SDK
    buildToolsVersion PROJECT_BUILD_TOOLS

    defaultConfig {
        minSdkVersion PROJECT_MIN_SDK
        targetSdkVersion PROJECT_TARGET_SDK
        versionCode LIBRARY_VERSION_CODE
        versionName LIBRARY_VERSION

        javaCompileOptions {
            annotationProcessorOptions {
                arguments = ["room.schemaLocation": "$projectDir/schemas".toString()]
            }
        }
    }

    buildTypes {
        release {
            minifyEnabled false
            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'
        }
    }

    compileOptions {
        targetCompatibility JavaVersion.VERSION_1_7
        sourceCompatibility JavaVersion.VERSION_1_7
    }

    flavorDimensions "compatibility"
    productFlavors {
        support {
            dimension "compatibility"
            processor.symbols "SUPPORT"
            matchingFallbacks = ['debug', 'release']
            testInstrumentationRunner "android.support.test.runner.AndroidJUnitRunner"
        }
        androidx {
            dimension "compatibility"
            processor.symbols "ANDROIDX"
            matchingFallbacks = ['debug', 'release']
            testInstrumentationRunner "androidx.test.runner.AndroidJUnitRunner"
        }
    }
}

// Dynamic dependencies for Compat module (AndroidX/Support)
/*android.libraryVariants.all { variant ->
    println ( "RAFA: " + variant.buildType.name)
    if (variant.buildType.name == "debug") {
        dependencies{
            debugApi project(path: ':compat')
        }
    }
    else {
        if (variant.flavorName == 'androidx') {
            dependencies.androidxApi "es.rafaco.compat:androidx:$LIBRARY_VERSION"
        } else {
            dependencies.supportApi "es.rafaco.compat:support:$LIBRARY_VERSION"
        }
    }
}
//androidxImplementation "es.rafaco.compat:androidx:$LIBRARY_VERSION"
//supportImplementation "es.rafaco.compat:support:$LIBRARY_VERSION"
*/

dependencies {

    api project(path: ':compat')
    // AndroidX/Support view components, inherited from compat module:
    //    androidxApi "androidx.appcompat:appcompat:$libraryAndroidxVersion"
    //    supportApi "com.android.support:appcompat-v7:$appSupportVersion"
    //    androidxApi "com.google.android.material:material:$libraryAndroidxMaterialVersion"
    //    supportApi "com.android.support:design:$appSupportVersion"
    //    supportApi "com.android.support:support-v4:$appSupportVersion"
    //    androidxApi "androidx.recyclerview:recyclerview:$libraryAndroidxVersion"
    //    supportApi "com.android.support:recyclerview-v7:$appSupportVersion"

    // AndroidX logic components
    androidxApi "androidx.annotation:annotation:$libraryAndroidxVersion"
    androidxApi "androidx.room:room-runtime:$libraryAndroidx2Version"
    androidxAnnotationProcessor "androidx.room:room-compiler:$libraryAndroidx2Version"
    androidxApi "androidx.lifecycle:lifecycle-runtime:$libraryAndroidx2Version"
    androidxApi "androidx.lifecycle:lifecycle-extensions:$libraryAndroidx2Version"
    androidxAnnotationProcessor "androidx.lifecycle:lifecycle-compiler:$libraryAndroidx2Version"
    androidxApi "androidx.paging:paging-runtime:$libraryAndroidx2Version"

    // Support logic components
    supportApi "com.android.support:support-annotations:$librarySupportVersion"
    supportApi "android.arch.persistence.room:runtime:$librarySupportArchVersion"
    supportAnnotationProcessor "android.arch.persistence.room:compiler:$librarySupportArchVersion"
    supportApi "android.arch.lifecycle:extensions:$librarySupportArchVersion"
    supportApi "android.arch.lifecycle:runtime:$librarySupportArchVersion"
    supportAnnotationProcessor "android.arch.lifecycle:compiler:$librarySupportArchVersion"
    supportApi "android.arch.paging:runtime:$librarySupportPagingVersion"

    // Pandora
    androidxApi "com.github.whataa:pandora:androidx_v2.0.6"
    supportApi "com.github.whataa:pandora:v2.0.6"

    // Retrofit
    api 'com.squareup.retrofit2:retrofit:2.6.2'
    api 'com.squareup.retrofit2:converter-gson:2.6.2'
    api 'com.squareup.okhttp3:logging-interceptor:3.9.0'

    // Others
    api 'com.github.alorma:timelineview:2.3.0'
    api 'com.github.anrwatchdog:anrwatchdog:1.3.0'
    api "com.github.nisrulz:easydeviceinfo-base:2.4.1"
    //api 'com.opencsv:opencsv:4.2' // Using org.apache.commons

    //Test
    testImplementation 'junit:junit:4.12'

    // AndroidX/Support test components (TODO)
    androidTestAndroidxImplementation 'androidx.test:runner:1.1.0'
    androidTestAndroidxImplementation 'androidx.test.espresso:espresso-core:3.1.0'
    androidTestSupportImplementation 'com.android.support.test:runner:1.0.2'
    androidTestSupportImplementation 'com.android.support.test.espresso:espresso-core:3.0.2'
    testSupportImplementation "android.arch.persistence.room:testing:$librarySupportArchVersion"
    testSupportImplementation "android.arch.core:core-testing:$librarySupportArchVersion"
    testSupportImplementation "android.arch.paging:common:$librarySupportPagingVersion"
}

/*inappdevtools {
    //// User features fags
    //email = 'inappdevtools@gmail.com'

    //// Build flags (affect plugin)
    //enabled = true
    //enabledOnRelease = true
    debug = true
    //sourceInclusion = false
    //sourceInspection = false

    //// Runtime flags (used later on)
    //overlayEnabled = false
    //invocationByShake = false
    //invocationByIcon = true
    //callDefaultCrashHandler = true
}*/


sonarqube {
    androidVariant 'supportDebug'
}